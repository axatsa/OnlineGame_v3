# Отчет об аудите проекта

## 1. Чего не хватает (Missing Features)
- **UI для продвинутых генераторов**: ~~Бэкенд поддерживает генерацию **Викторин (Quiz)**, **Jeopardy (Своя игра)** и **Заданий (Assignment)** (`backend/routes/generator.py`), но во фронтенде `Generator.tsx` реализованы **только Математика и Кроссворд**.~~ (Реализовано)
- **Редактирование кроссвордов**: ~~Фронтенд явно заявляет: "Редактирование макета кроссворда пока не поддерживается" (Строка 179 в `Generator.tsx`).~~ (Реализовано через JSON)
- **Полноценные логи аудита**: `backend/routes/admin.py` логирует только "Создание Организации". Другие критически важные действия (удаление пользователей, изменение настроек) не логируются.
- **Сброс пароля**: Есть эндпоинт `change-password`, но нет потока "Забыл пароль" (восстановление через email).

## 2. Ошибки и Уязвимости (Errors & Vulnerabilities)
- **Хрупкий парсинг JSON от ИИ**: В `backend/services/openai_service.py` парсинг JSON полагается на простую замену строк (`replace("```json", "")`). Это сломается, если ИИ добавит любой текст до или после JSON.
- **Секреты в логах**: ~~`backend/routes/auth.py` использует `print()` для отладки создания токенов. Это плохая практика для продакшен-логов (утечка данных).~~ (Исправлено: `print` заменен на `logging`, секреты удалены)
- **Несоответствие схем**: Комментарии в `backend/routes/generator.py` указывают на неуверенность в полях `CrosswordRequest` (`# Note: CrosswordRequest might not have class_id...`).

## 3. Нелогичные моменты (Illogical/Inconsistent Moments)
- **Жесткие редиректы**: `front/src/lib/api.ts` принудительно делает редирект на `/` при любой ошибке 401. Это вызывает полную перезагрузку страницы вместо плавного перехода на логин.
- **Ручное создание словарей**: В `backend/routes/admin.py`, функция `get_payments` вручную собирает словарь, чтобы добавить `org_name`, вместо использования схем Pydantic с `ORM mode`.
- **Хардкод моделей**: ~~Сервис OpenAI жестко привязан к `gpt-3.5-turbo`. Если захочется использовать GPT-4 или более дешевую модель, придется менять код.~~ (Исправлено: теперь конфигурируется через `OPENAI_MODEL`)

## 4. Заглушки (Stubs & Placeholders)
- **Режим редактирования (Frontend)**: Кнопка "Редактировать" для кроссвордов — это заглушка, которая показывает уведомление "не поддерживается".
- **Context класса**: Функция `get_class_context` в `generator.py` возвращает пустые строки, если класс не выбран. Это нормально, но промпт для ИИ может стать менее качественным без дефолтных значений.

## Рекомендации
1.  **Реализовать недостающий UI**: Добавить вкладки для Викторины, Jeopardy и Заданий в `Generator.tsx`.
2.  **Надежный парсер JSON**: Использовать библиотеку или лучшую логику для извлечения JSON из ответов ИИ в `openai_service.py`.
3.  **Очистить логи**: Убрать `print` с токенами и создать декоратор для логирования действий админа.
